<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Fluent mocking for unit tests &#183; Rodrigo Dumont</title><meta name=description content="If you seriously write unit tests in C#, then I'm sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of setting up mocks."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.62.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Fluent mocking for unit tests"><meta property="og:description" content="If you seriously write unit tests in C#, then I'm sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of setting up mocks."><meta property="og:type" content="article"><meta property="og:url" content="http://rodrigodumont.com/2013/09/26/fluent-mocking-for-unit-tests/"><link rel=stylesheet href=http://rodrigodumont.com/dist/site.css><link rel=stylesheet href=http://rodrigodumont.com/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-42693325-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title="Rodrigo Dumont" href=http://rodrigodumont.com/>Rodrigo Dumont</a></h1><a class=button-square href=http://rodrigodumont.com/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/rlsdumont rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Gitlab title=Gitlab href=https://gitlab.com/rdumont rel=me><i class="fa fa-gitlab"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/rdumont rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href=https://stackoverflow.com/users/186760/rdumont rel=me><i class="fa fa-stack-overflow"></i></a><a class="button-square button-social hint--top" data-hint=LinkedIn title=LinkedIn href=https://linkedin.com/in/rdumont rel=me><i class="fa fa-linkedin"></i></a><a class="button-square button-social hint--top" data-hint=Email title=Email href=mailto:hi@rodrigodumont.com><i class="fa fa-envelope"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=Blog href=/>Blog</a></li><li class=site-nav-item><a title=Projects href=/page/projects>Projects</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Fluent mocking for unit tests</h1><p class="post-date post-line"><span>Published <time datetime=2013-09-26 itemprop=datePublished>Thu, Sep 26, 2013</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/rdumont itemprop=url rel=author>Rodrigo Dumont</a></span></span></p></header><div class="post-content clearfix" itemprop=articleBody><p>If you seriously write <strong>unit tests in C#</strong>, then I'm sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of <strong>setting up mocks</strong>.</p><p>Let's say you had to do something like the following. Maybe you would even choose to write a mock class instead of using our good friend <strong><a href=https://github.com/Moq/moq4 title=Moq>Moq</a></strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[Test]</span>
<span style=color:#66d9ef>void</span> Find_beer_that_harmonizes()
{
    <span style=color:#75715e>// Arrange
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> beer1 = <span style=color:#66d9ef>new</span> Mock&lt;IBeer&gt;();
    beer2.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;<span style=color:#66d9ef>string</span>&gt;)).Returns(<span style=color:#66d9ef>false</span>);
    beer1.Setup(b =&gt; b.HarmonizesWith(<span style=color:#e6db74>&#34;pasta&#34;</span>)).Returns(<span style=color:#66d9ef>true</span>);
    
    <span style=color:#66d9ef>var</span> beer2 = <span style=color:#66d9ef>new</span> Mock&lt;IBeer&gt;();
    beer2.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;<span style=color:#66d9ef>string</span>&gt;)).Returns(<span style=color:#66d9ef>false</span>);
    beer2.Setup(b =&gt; b.HarmonizesWith(<span style=color:#e6db74>&#34;cheese&#34;</span>)).Returns(<span style=color:#66d9ef>true</span>);
    
    <span style=color:#66d9ef>var</span> beer3 = <span style=color:#66d9ef>new</span> Mock&lt;IBeer&gt;();
    beer3.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;<span style=color:#66d9ef>string</span>&gt;)).Returns(<span style=color:#66d9ef>false</span>);
    beer3.Setup(b =&gt; b.HarmonizesWith(<span style=color:#e6db74>&#34;seafood&#34;</span>)).Returns(<span style=color:#66d9ef>true</span>);
    
    <span style=color:#66d9ef>var</span> beers = <span style=color:#66d9ef>new</span> IBeer[] { beer1, beer2, beer3 };
    <span style=color:#66d9ef>var</span> harmonizer = <span style=color:#66d9ef>new</span> BeerHarmonizer(beers);

    <span style=color:#75715e>// Act
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> chosenBeer = harmonizer.ChooseBeerByFood(<span style=color:#e6db74>&#34;cheese&#34;</span>);

    <span style=color:#75715e>// Assert
</span><span style=color:#75715e></span>    Assert.That(chosenBeer, Is.SameAs(beers[<span style=color:#ae81ff>1</span>]));
}
</code></pre></div><p>Although this may seem like a simple step, it sure is a helpful one. The <code>Mock.Of&lt;TObject>()</code> syntax allows us to directly get the mock proxy, instead of having to deal with <code>myMock.Object</code>. Now, we can write simple <strong>extension methods</strong> that hide de setup complexity far from sight, but still just one click away. Much cleaner and readable, right?</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[Test]</span>
<span style=color:#66d9ef>void</span> Find_beer_that_harmonizes()
{
    <span style=color:#75715e>// Arrange
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> beers = <span style=color:#66d9ef>new</span> IBeer[]
    {
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(<span style=color:#e6db74>&#34;pasta&#34;</span>);
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(<span style=color:#e6db74>&#34;cheese&#34;</span>);
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(<span style=color:#e6db74>&#34;seafood&#34;</span>);
    };
    <span style=color:#66d9ef>var</span> harmonizer = <span style=color:#66d9ef>new</span> BeerHarmonizer(beers);

    <span style=color:#75715e>// Act
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> chosenBeer = harmonizer.ChooseBeerByFood(<span style=color:#e6db74>&#34;cheese&#34;</span>);

    <span style=color:#75715e>// Assert
</span><span style=color:#75715e></span>    Assert.That(chosenBeer, Is.SameAs(beers[<span style=color:#ae81ff>1</span>]));
}
</code></pre></div><p>Below is the actual extension method.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> IBeer ThatHarmonizesWith(<span style=color:#66d9ef>this</span> IBeer beer, <span style=color:#66d9ef>string</span> food)
{
    <span style=color:#66d9ef>var</span> mock = Mock.Get(beer);
    mock.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;<span style=color:#66d9ef>string</span>&gt;)).Returns(<span style=color:#66d9ef>false</span>);
    mock.Setup(b =&gt; b.HarmonizesWith(food)).Returns(<span style=color:#66d9ef>true</span>);

    <span style=color:#66d9ef>return</span> beer;
}
</code></pre></div><p>I hope this simple tip was helpful to you. Keep TDDing and remember: readability is the key!</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/moq/>moq</a>,
<a href=/tags/unit-tests/>unit-tests</a>,
<a href=/tags/csharp/>csharp</a>,
<a href=/tags/tdd/>tdd</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Fluent%20mocking%20for%20unit%20tests&url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a>
<a class=icon-google-plus href="https://plus.google.com/share?url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f" onclick="window.open(this.href,'google-plus-share','width=490,height=530');return false;"><i class="fa fa-google-plus"></i><span class=hidden>Google+</span></a>
<a class=icon-linkedin href="https://www.linkedin.com/shareArticle?mini=true&title=Fluent%20mocking%20for%20unit%20tests&url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f&summary=" onclick="window.open(this.href,'linkedin-share','width=554,height=481');return false;"><i class="fa fa-linkedin"></i><span class=hidden>LinkedIn</span></a></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"rodrigodumont"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title="Rodrigo Dumont" href=http://rodrigodumont.com/>Rodrigo Dumont</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2017 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=http://rodrigodumont.com/js/jquery-1.11.3.min.js></script><script src=http://rodrigodumont.com/js/jquery.fitvids.js></script><script src=http://rodrigodumont.com/js/scripts.js></script></body></html>