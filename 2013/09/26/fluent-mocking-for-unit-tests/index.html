<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Fluent mocking for unit tests &middot; Rodrigo Dumont</title>
        <meta name="description" content="If you seriously write unit tests in C#, then I&rsquo;m sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of setting up mocks.

">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.30-DEV" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta property="og:title" content="Fluent mocking for unit tests">
<meta property="og:description" content="If you seriously write unit tests in C#, then I&rsquo;m sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of setting up mocks.

">
<meta property="og:type" content="article">
<meta property="og:url" content="http://rodrigodumont.com/2013/09/26/fluent-mocking-for-unit-tests/">
        <link rel="stylesheet" href="http://rodrigodumont.com/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        
    </head>
    <body>
        
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'XXX', 'auto');
ga('send', 'pageview');
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Rodrigo Dumont" href="http://rodrigodumont.com/">Rodrigo Dumont</a>
                            </h1>
                        
                        <a class="button-square" href="http://rodrigodumont.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/rlsdumont">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Gitlab" title="Gitlab" href="https://gitlab.com/rdumont">
                                <i class="fa fa-gitlab"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/rdumont">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Stack Overflow" title="Stack Overflow" href="https://stackoverflow.com/users/186760/rdumont">
                                <i class="fa fa-stack-overflow"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="https://linkedin.com/in/rdumont">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" title="Email" href="mailto:hi@rodrigodumont.com">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="/">Blog</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Fluent mocking for unit tests</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2013-09-26" itemprop="datePublished">Thu, Sep 26, 2013</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="https://github.com/rdumont" itemprop="url" rel="author">Rodrigo Dumont</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>If you seriously write <strong>unit tests in C#</strong>, then I&rsquo;m sure that you have sometimes come to a point where there are just too many, or perhaps too complex mocks in your code. When that happens, you can almost feel yourself giving in to the dark side and using an actual implementation just to avoid all the mess of <strong>setting up mocks</strong>.</p>

<p></p>

<p>Let&rsquo;s say you had to do something like the following. Maybe you would even choose to write a mock class instead of using our good friend <strong><a href="https://github.com/Moq/moq4" title="Moq">Moq</a></strong>.</p>

<pre><code class="language-csharp">[Test]
void Find_beer_that_harmonizes()
{
    // Arrange
    var beer1 = new Mock&lt;IBeer&gt;();
    beer2.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;string&gt;)).Returns(false);
    beer1.Setup(b =&gt; b.HarmonizesWith(&quot;pasta&quot;)).Returns(true);
    
    var beer2 = new Mock&lt;IBeer&gt;();
    beer2.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;string&gt;)).Returns(false);
    beer2.Setup(b =&gt; b.HarmonizesWith(&quot;cheese&quot;)).Returns(true);
    
    var beer3 = new Mock&lt;IBeer&gt;();
    beer3.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;string&gt;)).Returns(false);
    beer3.Setup(b =&gt; b.HarmonizesWith(&quot;seafood&quot;)).Returns(true);
    
    var beers = new IBeer[] { beer1, beer2, beer3 };
    var harmonizer = new BeerHarmonizer(beers);

    // Act
    var chosenBeer = harmonizer.ChooseBeerByFood(&quot;cheese&quot;);

    // Assert
    Assert.That(chosenBeer, Is.SameAs(beers[1]));
}
</code></pre>

<p>Although this may seem like a simple step, it sure is a helpful one. The <code>Mock.Of&lt;TObject&gt;()</code> syntax allows us to directly get the mock proxy, instead of having to deal with <code>myMock.Object</code>. Now, we can write simple <strong>extension methods</strong> that hide de setup complexity far from sight, but still just one click away. Much cleaner and readable, right?</p>

<pre><code class="language-csharp">[Test]
void Find_beer_that_harmonizes()
{
    // Arrange
    var beers = new IBeer[]
    {
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(&quot;pasta&quot;);
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(&quot;cheese&quot;);
        Mock.Of&lt;IBeer&gt;().ThatHarmonizesWith(&quot;seafood&quot;);
    };
    var harmonizer = new BeerHarmonizer(beers);

    // Act
    var chosenBeer = harmonizer.ChooseBeerByFood(&quot;cheese&quot;);

    // Assert
    Assert.That(chosenBeer, Is.SameAs(beers[1]));
}
</code></pre>

<p>Below is the actual extension method.</p>

<pre><code class="language-csharp">public static IBeer ThatHarmonizesWith(this IBeer beer, string food)
{
    var mock = Mock.Get(beer);
    mock.Setup(b =&gt; b.HarmonizesWith(It.IsAny&lt;string&gt;)).Returns(false);
    mock.Setup(b =&gt; b.HarmonizesWith(food)).Returns(true);

    return beer;
}
</code></pre>

<p>I hope this simple tip was helpful to you. Keep TDDing and remember: readability is the key!</p>
</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=Fluent%20mocking%20for%20unit%20tests&url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
            <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f"
              onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
              <i class="fa fa-google-plus"></i>
                <span class="hidden">Google+</span>
            </a>
        
        
            <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&title=Fluent%20mocking%20for%20unit%20tests&url=http%3a%2f%2frodrigodumont.com%2f2013%2f09%2f26%2ffluent-mocking-for-unit-tests%2f&summary="
               onclick="window.open(this.href, 'linkedin-share', 'width=554,height=481');return false;">
               <i class="fa fa-linkedin"></i>
               <span class="hidden">LinkedIn</span>
            </a>
        
    </div>
</footer>

        
    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="Rodrigo Dumont" href="http://rodrigodumont.com/">Rodrigo Dumont</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2014 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="http://rodrigodumont.com/js/jquery-1.11.3.min.js"></script>
        <script src="http://rodrigodumont.com/js/jquery.fitvids.js"></script>
        
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        <script src="http://rodrigodumont.com/js/scripts.js"></script>
    </body>
</html>

